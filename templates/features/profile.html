{% extends "base.html" %}

{% block title %}Perfil do Usuário{% endblock %}

{% block custom_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
{% endblock %}

{% block content %}
<div class="profile-container">
<nav aria-label="breadcrumb" class="breadcrumb-nav profile-breadcrumb">
    <ul class="breadcrumb profile-breadcrumb-list">
        <li class="breadcrumb-item">
            <i class="fas fa-home" aria-hidden="true"></i>
            <a href="{{ url_for('main.home') }}" class="breadcrumb-link">Home</a>
        </li>
        <li class="breadcrumb-separator" aria-current="page">></li>
        <li class="breadcrumb-current">Perfil do Usuário</li>
    </ul>
</nav>

<h1>Perfil do Usuário</h1>

<div>
  <h2>Foto de Perfil</h2>
  {% if user.profile_photo_url %}
    <img src="{{ user.profile_photo_url }}" alt="Foto de Perfil" class="profile-photo">
  {% else %}
    <i class="fas fa-user-circle profile-photo" aria-hidden="true" title="Ícone de usuário"></i>
  {% endif %}
  <form id="upload-photo-form" method="POST" enctype="multipart/form-data" action="{{ url_for('main.upload_profile_photo') }}">
    <input type="file" name="photo" accept="image/png, image/jpeg" required>
    <button type="submit">Enviar Foto</button>
  </form>
  <div id="upload-result"></div>
</div>

<div class="profile-info">
  <h2>Informações do Perfil</h2>
  <form id="profile-info-form" method="POST" action="#">
    <label for="nome">Nome:</label>
    <input type="text" id="nome" name="nome" value="{{ user.nome or '' }}" disabled>

    <label for="telefone">Telefone:</label>
    <input type="text" id="telefone" name="telefone" value="{{ user.telefone or '' }}" disabled>

    <label for="instagram">Instagram:</label>
    <input type="text" id="instagram" name="instagram" value="{{ user.instagram or '' }}" disabled>

    <!-- Additional fields can be added here -->

    <!-- For now, fields are disabled; editing functionality can be added later -->
  </form>
</div>

<script>
document.getElementById('upload-photo-form').addEventListener('submit', async function(event) {
  event.preventDefault();
  const formData = new FormData(this);
  const response = await fetch(this.action, {
    method: 'POST',
    body: formData
  });
  const result = await response.json();
  const resultDiv = document.getElementById('upload-result');
  if (result.success) {
    resultDiv.textContent = 'Foto enviada com sucesso!';
    // Update the profile photo image src
    const img = document.querySelector('img[alt="Foto de Perfil"]');
    if (img) {
      img.src = result.photo_url + '?t=' + new Date().getTime(); // cache bust
    } else {
      // If no image element, reload page to show new photo
      location.reload();
    }
  } else {
    resultDiv.textContent = 'Erro ao enviar foto: ' + result.error;
  }
});
</script>
</div>

{% endblock %}
